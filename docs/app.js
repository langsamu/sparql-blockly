(()=>{"use strict";var t={722:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AppMain=void 0;class n extends HTMLElement{constructor(){super(...arguments),this.monitorHash=!0}connectedCallback(){document.addEventListener("DOMContentLoaded",this.onLoad.bind(this)),window.addEventListener("hashchange",this.onHash.bind(this))}get sparql(){return this.querySelector("sparql-editor")}get blockly(){return this.querySelector("blockly-canvas")}onHash(){this.monitorHash&&this.setFromHash()}onLoad(){this.sparql.addEventListener("sparql",this.onSparql.bind(this)),this.sparql.addEventListener("input",this.onInput.bind(this)),this.blockly.addEventListener("blocks",this.onBlocks.bind(this)),this.blockly.addEventListener("load",this.onBlocklyLoad.bind(this)),this.blockly.addEventListener("execute",this.onBlocklyExecute.bind(this))}onSparql(t){this.blockly.dom=t.detail}onInput(){this.updateUrl()}onBlocks(t){this.sparql.value=t.detail,this.updateUrl()}onBlocklyLoad(){this.setFromHash()}onBlocklyExecute(t){window.open(`${t.detail}${encodeURIComponent(this.sparql.value)}`)}setFromHash(){const t=window.location.hash.split("#")[1];t&&this.sparql.setAndNotify(decodeURIComponent(t))}updateUrl(){this.monitorHash=!1,window.location.hash=encodeURIComponent(this.sparql.value),window.setTimeout((()=>this.monitorHash=!0),250)}}e.AppMain=n},79:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function a(t){try{r(i.next(t))}catch(t){o(t)}}function l(t){try{r(i.throw(t))}catch(t){o(t)}}function r(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,l)}r((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.BlocklyCanvas=void 0;const s=n(864),o=n(964);class a extends HTMLElement{constructor(){super(...arguments),this.typing=!1}connectedCallback(){return i(this,void 0,void 0,(function*(){s.Blocks.sparql11_faketallblock={init:function(){this.appendDummyInput(),this.appendDummyInput()}};const t={sounds:!1,toolbox:yield this.getToolboxData(),horizontalLayout:window.innerWidth<768,zoom:{controls:!0,wheel:!0,startScale:1,maxScale:3,minScale:.01,scaleSpeed:1.2,pinch:!0}},e=s.inject(this,t);e.addChangeListener(this.workspaceChanged.bind(this)),window.setInterval((()=>s.svgResize(e)),1e3),e.registerButtonCallback("example",a.exampleButtonClicked),e.registerButtonCallback("execute",this.executeButtonClicked.bind(this)),this.dispatchEvent(new Event("load"))}))}set dom(t){if(t){const e=s.getMainWorkspace();e.clear(),this.typing=!0,s.Xml.domToWorkspace(t,e)}}getToolboxData(){return i(this,void 0,void 0,(function*(){const t=this.getAttribute("toolbox-data"),e=yield fetch(t);return yield e.text()}))}workspaceChanged(t){switch(t.type){case s.Events.CHANGE:case s.Events.DELETE:case s.Events.MOVE:this.typing||this.generateCode();break;case s.Events.FINISHED_LOADING:this.typing=!1}}generateCode(){const t=s.getMainWorkspace();for(const e of t.getTopBlocks(!1))switch(e.type){case"sparql11_query":case"sparql11_update":this.dispatchEvent(new CustomEvent("blocks",{detail:o.blocklyToSparql(e)}))}}static exampleButtonClicked(t){window.location.hash=encodeURIComponent(t.info.query),t.getTargetWorkspace().getFlyout().hide()}executeButtonClicked(t){this.dispatchEvent(new CustomEvent("execute",{detail:t.info.endpoint}))}}e.BlocklyCanvas=a},234:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(s,o){function a(t){try{r(i.next(t))}catch(t){o(t)}}function l(t){try{r(i.throw(t))}catch(t){o(t)}}function r(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,l)}r((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.SparqlEditor=void 0;const s=n(964);class o extends HTMLElement{connectedCallback(){return i(this,void 0,void 0,(function*(){this.editorElement.addEventListener("input",this.input.bind(this))}))}get editorElement(){return this.querySelector("textarea")}get errorElement(){return this.querySelector("span")}set error(t){this.errorElement.innerText=t}get value(){return this.editorElement.value}set value(t){this.editorElement.value=t,this.validate()}setAndNotify(t){this.editorElement.value=t,this.input()}input(){const t=this.validate();t&&this.dispatchEvent(new CustomEvent("sparql",{detail:t}))}validate(){this.error="",this.classList.remove("invalid"),this.classList.remove("valid");const t=this.value;if(t)try{const e=s.sparqlToBlockly(t);return this.classList.add("valid"),e}catch(t){this.error=t.message,this.classList.add("invalid")}}}e.SparqlEditor=o},864:t=>{t.exports=Blockly},964:t=>{t.exports=SparqlBlockly}},e={};function n(i){var s=e[i];if(void 0!==s)return s.exports;var o=e[i]={exports:{}};return t[i].call(o.exports,o,o.exports,n),o.exports}(()=>{const t=n(722),e=n(79),i=n(234);customElements.define("app-main",t.AppMain),customElements.define("blockly-canvas",e.BlocklyCanvas),customElements.define("sparql-editor",i.SparqlEditor)})()})();